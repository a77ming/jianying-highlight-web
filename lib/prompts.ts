/**
 * Facebook原创性合规提示词配置
 * 确保AI生成的剪辑方案符合Facebook的"有意义润色"标准
 */

export const FACEBOOK_ORIGINALITY_GUIDELINES = `
## Facebook原创性政策 - 必须遵守 ⚠️

### ❌ 以下做法违反Facebook政策（绝对禁止）：

1. **简单剪辑拼接**：只是将片段拼接在一起，无附加价值
2. **仅添加水印/徽标/边框**：视觉装饰不属于有意义润色
3. **仅添加背景音乐**：音乐不构成原创性
4. **调整播放速度**：加速/减速视频不构成原创性
5. **添加与音频相同的字幕**：仅翻译或添加同语言字幕不够
6. **仅介绍视频内容**："这个视频讲的是..."这种介绍不够
7. **反应视频但附加价值极小**：只是看视频反应不够
8. **汇总多个来源但未润色**：收集多个视频但无创意加工
9. **重复发布相同内容**：已发布内容重新发布无改动

### ✅ 以下做法符合Facebook政策（必须做到）：

1. **创意编辑**：
   - 独特的剪辑节奏和转场
   - 非线性的叙事结构（倒叙、插叙、多线叙事）
   - 对比、呼应、象征等电影手法
   - 视觉特效增强情感表达

2. **有意义的旁白/解说**：
   - 独特的观点和分析（不是复述剧情）
   - 人物心理分析
   - 剧情隐喻解读
   - 社会议题探讨
   - 幽默吐槽或讽刺评论
   - 教育性解说（解释术语、背景知识）

3. **添加有意义的新信息**：
   - 背景知识补充
   - 人物关系图谱
   - 剧情预测或假设
   - 与其他作品的对比
   - 制作花絮或幕后信息
   - 数据统计（如果适用）

4. **创意性二创手法**：
   - 重新构建叙事框架（改变叙事视角）
   - 添加悬念和反转
   - 使用闪回、预闪等手法
   - 对比剪辑（过去vs现在、表面vs真相）
   - 情感放大（慢镜头、音乐配合、画外音）
   - 视觉隐喻（字幕、特效、符号）

### 🎯 必须包含的原创元素（每个Reel至少3项）：

A. **独特画外音/旁白**（必须）
   - 不是简单翻译或复述
   - 提供新视角、新解读
   - 有明确观点或情感立场

B. **创意性剪辑手法**（至少2种）
   - 非线性叙事
   - 对比剪辑
   - 悬疑节奏
   - 情感递进

C. **视觉增强元素**（至少1种）
   - 信息字幕（非对话字幕）
   - 强调文字或符号
   - 图表或图示
   - 特效说明

D. **新信息内容**（至少1种）
   - 背景知识
   - 人物分析
   - 主题探讨
   - 社会议题

### 📋 原创性自检清单：

生成剪辑方案时，必须确认：
- [ ] 画外音提供了独特观点，而非简单翻译
- [ ] 剪辑有创意结构，而非按时间顺序拼接
- [ ] 添加了新信息（分析、背景、解读等）
- [ ] 视觉上有创意元素（字幕、特效、符号等）
- [ ] 整体叙事有明确立场或情感导向
- [ ] 内容不能仅靠观看原视频获得

`;

export const CREATIVE_EDITING_TECHNIQUES = `
## 创意剪辑技巧库（可组合使用）

### 叙事结构类：
1. **倒叙悬疑法**：先展示结果/高潮，再倒推原因
2. **对比揭示法**：表象vs真相、承诺vs行动、现在vs过去
3. **多重视角法**：从不同角色的视角重新讲述
4. **假设分析法**："如果...会怎样"的假设性讨论
5. **情感递进法**：从平静到激烈的情感曲线设计

### 视觉增强类：
1. **信息字幕法**：添加人物标签、关系说明、心理活动
2. **强调符号法**：关键词放大、闪烁、变色强调
3. **图表辅助法**：时间线、关系图、数据可视化
4. **特效隐喻法**：用画面特效象征心理状态或主题

### 画外音风格类：
1. **侦探解读风**：像侦探分析案件一样分析人物动机
2. **情感共鸣风**：从情感角度切入，引发观众共鸣
3. **幽默吐槽风**：幽默吐槽剧中的不合理或戏剧化桥段
4. **教育科普风**：科普相关知识（心理学、社会学等）
5. **社会议题风**：联系现实社会议题进行讨论

### 情感引导类：
1. **悬念铺垫法**：设置悬念，引发好奇
2. **反转制造法**：预期与现实的反转
3. **情感放大法**：通过音乐、慢镜头、画外音放大情感
4. **代入引导法**："如果你是他，你会怎么做？"等代入式引导

`;

export const generatePrompt = (
  synopsis: string,
  subtitleText: string,
  maxHighlights: number,
  minDuration: number,
  maxDuration: number
) => {
  return `你是一个专业的短视频二创内容制作人，专门创作符合Facebook原创性标准的高质量短剧二创内容。

${FACEBOOK_ORIGINALITY_GUIDELINES}

${CREATIVE_EDITING_TECHNIQUES}

## 📖 短剧简介
${synopsis || '（未提供简介，请根据字幕内容推断）'}

## 📝 完整字幕内容
${subtitleText}

## 🎯 你的任务

请从上述字幕中识别出 ${maxHighlights} 个最适合做Facebook Reel的精彩片段，并为每个片段设计**符合Facebook原创性标准**的二创方案。

### 时长要求
- 每个片段时长: ${minDuration}-${maxDuration} 秒
- 选择有冲突、悬念、情感张力、或关键转折的片段

### 原创性要求（必须遵守）⚠️

每个Reel方案必须包含：

**1. 独特的画外音/旁白**（最关键）
- ❌ 不能只是翻译或复述对话
- ✅ 必须提供：人物心理分析、动机解读、关系分析、社会议题探讨、幽默吐槽、教育科普等
- ✅ 必须有明确观点或情感立场

**2. 创意性剪辑结构**
- ❌ 不能按时间顺序简单拼接
- ✅ 使用：倒叙、对比、多线叙事、悬念设置、情感递进等

**3. 信息字幕方案**
- ❌ 不能只有对话翻译字幕
- ✅ 添加：人物标签、关系说明、心理活动、关键词强调、数据图表等

**4. 新信息内容**
- ❌ 不能仅展示原画面
- ✅ 提供：背景知识、分析解读、预测讨论、现实联系等

## 📋 输出格式

请以JSON数组格式输出，每个元素包含：

{
  "title": "Reel标题（吸引眼球且符合内容）",
  "hook_subtitle": "开幕钩子（最吸引人的台词或问题）",
  "start_time": "开始时间（格式 HH:MM:SS）",
  "end_time": "结束时间（格式 HH:MM:SS）",

  "cut_sequence": "剪辑顺序描述（如何创意性地组织画面，使用倒叙/对比/多线等手法）",

  "scene_descriptions": [
    "每个画面的具体描述和剪辑要点",
    "包括：镜头角度、表情特写、动作细节等"
  ],

  "subtitle_strategy": {
    "original_subtitles": ["原对话字幕（保留关键对话）"],
    "info_captions": ["信息字幕：人物标签、心理活动、关系说明等"],
    "emphasis_elements": ["强调元素：关键词、符号、特效说明"]
  },

  "voiceover_script": "完整画外音文案（必须有！提供独特观点和分析，不是简单翻译）",
  "voiceover_style": "画外音风格：侦探解读/情感共鸣/幽默吐槽/教育科普/社会议题",

  "editing_direction": "详细剪辑说明：如何使用创意手法（非线性叙事、对比、悬念等）",
  "originality_elements": ["列出本Reel包含的原创性元素（必须≥3项）"],
  "target_emotion": "目标情感：悬念/好奇/愤怒/同情/思考/幽默等",
  "reason": "选择这个片段的原因，以及为什么这样剪辑能吸引观众"
}

## ✨ 优秀示例

[
  {
    "title": "他承诺保护她，但这一切都是谎言？",
    "hook_subtitle": "「I'll say I found him. Would you lie for someone you just met?」",
    "start_time": "00:00:18",
    "end_time": "00:00:32",
    "cut_sequence": "【倒叙开场】先展示Nate说'rookie mistake'的画面（黑暗、低沉音乐）→【对比揭示】切到Nate承诺保护Brooke的温暖画面（明亮音乐）→【悬疑提问】画外音：'哪个才是真的？'→【回到现实】Brooke信以为真的表情特写",
    "scene_descriptions": [
      "画面1: Nate说'rookie mistake'的特写，画面略微变暗，添加VHS滤镜效果",
      "画面2: Nate拥抱Brooke说'it's okay'的近景，温暖色调",
      "画面3: Nate眼神特写（慢镜头），在他承诺时捕捉眼神的闪烁",
      "画面4: Brooke信任的表情（慢镜头），不知情的画面"
    ],
    "subtitle_strategy": {
      "original_subtitles": ["I'll say I found him", "rookie mistake", "Would you lie?"],
      "info_captions": [
        "Nate承诺时：添加标签「保护者？OR 操控者？」",
        "rookie mistake时：闪烁文字「尸体处理的老手」",
        "Brooke信以为真时：小字「她不知道」"
      ],
      "emphasis_elements": [
        "关键词'Rookie'放大并变红",
        "Mistake字母逐个出现",
        "Would you lie?问号闪烁强调"
      ]
    },
    "voiceover_script": "「这是一个教科书级的操控现场。表面上看，Nate是一个陌生人为了保护Brooke而承诺撒谎。但注意他的用词——'Rookie mistake'（新手错误）。这暗示他不是第一次处理尸体。更关键的是，他为什么要对一个刚认识的人承诺这一切？真正的保护者会报警，而不是替你埋尸。这种'保护'背后，往往隐藏着更危险的控制欲。如果你遇到这种'完美保护者'，请记住：最快愿意为你犯罪的人，往往也是最容易对你犯罪的人。」",
    "voiceover_style": "侦探解读风+心理分析",
    "editing_direction": "使用对比剪辑手法：在Nate承诺的温暖画面和独白的冷酷画面之间快速切换，制造强烈的反差感。画外音在对比处插入，增强悬疑感。结尾用慢镜头展示Brooke的天真，让观众产生'不要信他'的冲动。整体节奏：前慢后快，结尾留悬念。",
    "originality_elements": [
      "✓ 独特心理分析（操控者vs保护者）",
      "✓ 对比剪辑手法（温暖vs冷酷）",
      "✓ 信息字幕（人物标签、关键揭示）",
      "✓ 教育性内容（识别操控的技巧）",
      "✓ 情感引导（让观众担心Brooke）"
    ],
    "target_emotion": "悬疑+警惕+思考",
    "reason": "这个片段展现了典型的情感操控现场，通过深度分析和对比剪辑，既有娱乐性又有教育意义，能让观众学会识别现实中的类似操控"
  }
]

## ⚠️ 质量标准

你生成的每个方案都必须通过以下检查：

1. **画外音检查**：
   - 是否提供了独特观点？是□ 否□
   - 是否能仅通过听画外音获得新信息？是□ 否□
   - 是否有明确的分析而非复述？是□ 否□

2. **剪辑创意检查**：
   - 是否有创意结构（非简单拼接）？是□ 否□
   - 是否使用了至少2种创意手法？是□ 否□

3. **原创元素检查**：
   - 是否包含≥3项原创性元素？是□ 否□
   - 内容是否仅通过观看原视频无法获得？是□ 否□

**如果以上有任何"否"，请重新设计！**

---

现在，请基于上述要求，分析短剧字幕，生成 ${maxHighlights} 个高质量、符合Facebook原创性标准的Reel二创方案。

只输出JSON数组，不要其他内容。`;
};
